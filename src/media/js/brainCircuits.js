(function(b){b.currMode=customEnum.mode.exploration;b.ignored_nodes=[]})(window.state=window.state||{},jQuery);(function(b){b.isAnonymous=!0;b.dataset_list=null;b.id=0;b.datasets={}})(window.user=window.user||{},jQuery);(function(b){b.nodes=null;b.links=null;b.nodes_force=null;b.links_force=null;b.maps=null})(window.activeDataset=window.activeDataset||{},jQuery);(function(b){b.name="BAMS(Public)";b.key=2130;b.isClone=0;b.origin=2130})(window.datasetProperties=window.datasetProperties||{},jQuery);(function(b,a,i){b.constructDataModel=function(a,b,d,f,k,m){user.datasets[a]={};for(var g={},l={},c={},n=b.length,q=0;q<n;++q){var p=b[q];p.key=parseInt(p.key);p.depth=parseInt(p.depth);p.parent=null===p.parentKey?null:parseInt(p.parentKey);p.circ={};p.children=[];g[p.key]=p;l[p.key]=[];c[p.key]=[]}for(var j in g)p=g[j],null!==p.parent&&(n=g[p.parent],n!==i?n.children.push(p.key):p.parent=null);user.datasets[a].node_map=g;user.datasets[a].node_in_neighbor_map=l;user.datasets[a].node_out_neighbor_map=
c;g={};l={};c=user.datasets[a];p=d.length;for(j=0;j<p;++j){var t=d[j],n=parseInt(t.sourceKey),q=parseInt(t.targetKey),t={key:parseInt(t.key),source:c.node_map[n],target:c.node_map[q],notes:t.notes,paper:t.paper,children:[],isDerived:!1,base_children:[]};g[t.key]=t;l[t.source.key+"-"+t.target.key]=t;c.node_in_neighbor_map[q].push(n);c.node_out_neighbor_map[n].push(q)}c.link_map=g;c.node_link_map=l;constructLinkHierarchy(a,d);d={};m=m.length;for(g=0;g<m;++g)l=data[g],d[l.key]=l;user.datasets[a].paper_map=
d;if(0<f.length||0<k.length){console.log(f);console.log(k);m=user_datasets[a].node_map;d=user_datasets[a].link_map;for(g=0;g<f.length;++g)switch(diff_entry=f[g],diff_entry.diff){case "AddNode":l={key:diff_entry.nodeKey,name:null,depth:0,parent:null,notes:null};b.push(l);m[l.key]=l;break;case "Rename":m[diff_entry.nodeKey].name=diff_entry.content;break;case "ChangeNote":m[diff_entry.nodeKey].notes=diff_entry.content}for(g=0;g<k.length;++g)switch(diff_entry=k[g],diff_entry.diff){case "ChangeNode":d[diff_entry.linkKey].notes=
diff_entry.content}}assignColors(user.datasets[a].node_map)};b.constructLinkHierarchy=function(b,h){for(var d=h.length,f=0,k=0;k<d;++k){var m=parseInt(h[k].key);m>f&&(f=m)}for(var g=user.datasets[b],k=0;k<d;++k){for(var m=parseInt(h[k].key),l=g.link_map[m],c=l.source,n=l.target,q=g.node_map[c.parent],p=g.node_map[n.parent],j=[],t=l.base_children.length,r=0;r<t;++r)j.push(l.base_children[r]);l.isDerived||(j.push(l.key),t+=1);if(null!==c.parent&&c.parent!==n.key&&0>a.inArray(n.key,q.children)){var r=
c.parent+"-"+n.key,u=g.node_link_map[r];if(u===i)f+=1,u={key:f,source:g.node_map[parseInt(c.parent)],target:n,notes:"Meta link",children:[m],isDerived:!0,base_children:j,paper:[]},g.link_map[f]=u,g.node_link_map[r]=u,g.node_in_neighbor_map[n.key].push(c.parent),g.node_out_neighbor_map[c.parent].push(n.key),h.push(u),d+=1;else{0>a.inArray(m,u.children)&&u.children.push(m);for(r=0;r<t;++r)l=j[r],0>a.inArray(l,u.base_children)&&u.base_children.push(l)}}if(null!==n.parent&&n.parent!==c.key&&0>a.inArray(c.key,
p.children))if(r=c.key+"-"+n.parent,u=g.node_link_map[r],u===i)f+=1,u={key:f,source:c,target:g.node_map[parseInt(n.parent)],notes:"Meta link",children:[m],isDerived:!0,base_children:j,paper:[]},g.link_map[f]=u,g.node_link_map[r]=u,g.node_in_neighbor_map[n.parent].push(c.key),g.node_out_neighbor_map[c.key].push(n.parent),h.push(u),d+=1;else{0>a.inArray(m,u.children)&&u.children.push(m);for(r=0;r<t;++r)l=j[r],0>a.inArray(l,u.base_children)&&u.base_children.push(l)}if(null!==c.parent&&null!==n.parent&&
c.parent!==n.parent&&0>a.inArray(n.key,q.children)&&0>a.inArray(c.key,p.children))if(r=c.parent+"-"+n.parent,q=g.node_link_map[r],q===i)f+=1,q={key:f,source:g.node_map[parseInt(c.parent)],target:g.node_map[parseInt(n.parent)],notes:"Meta link",children:[m],isDerived:!0,base_children:j,paper:[]},g.link_map[f]=q,g.node_link_map[r]=q,g.node_in_neighbor_map[n.parent].push(c.parent),g.node_out_neighbor_map[c.parent].push(n.parent),h.push(q),d+=1;else{0>a.inArray(m,q.children)&&q.children.push(m);for(r=
0;r<t;++r)l=j[r],0>a.inArray(l,q.base_children)&&q.base_children.push(l)}}}})(window.dataModel=window.dataModel||{},jQuery);(function(b){b.circNodes=null;b.circLinks=null;b.forceNodes=null;b.forceLinks=null;b.init=function(a){a=user.datasets[a];b.circNodes=[];b.circLinks=[];b.forceNodes=[];b.forceLinks=[];for(var i in a.node_map){var e=node_map[i];1===e.depth&&(e.isActive=!0,circNodes.push(e))}i=a.link_map;for(var h in i)a=i[h],1===a.source.depth&&1===a.target.depth&&(a.strength=20<a.base_children.length?"strong":1<a.base_children.length?"moderate":"weak",circLinks.push(a));h=b.circNodes.length;i=2*Math.PI/h;for(a=0;a<
h;++a){var e=b.circNodes[a],d=i,f=a;e.circ.start_angle=0+d*f;e.circ.end_angle=0+d*(f+1);d=d*(f+0.5)+0;f=inner_radius+(outer_radius-inner_radius)/2;e.circ.x=f*Math.cos(Math.PI/2-d);e.circ.y=-f*Math.sin(Math.PI/2-d)}}})(window.svgData=window.svgData||{},jQuery);
(function(b,a,i){function e(a,b){c.selectAll(".circular.node").data(active_data_nodes,function(a){return a.key}).exit().remove();c.selectAll(".circular.text").data(active_data_nodes,function(a){return a.key}).exit().remove();c.selectAll(".circular.link").data(active_data_links,function(a){return a.key}).exit().remove();k();f();for(var e=0;e<a;++e)calculateArcPositions(active_data_nodes[e],0,b,e);c.selectAll(".circular.link").data(active_data_links,function(a){return a.key}).transition().duration(1E3).attr("d",
function(a){return p([{x:a.source.circ.x,y:a.source.circ.y},{x:0,y:0},{x:a.target.circ.x,y:a.target.circ.y}])});c.selectAll(".circular.node").data(active_data_nodes,function(a){return a.key}).transition().duration(1E3).attr("d",q);c.selectAll(".circular.text").data(active_data_nodes,function(a){return a.key}).transition().duration(1E3).attr("x",function(a){return a.circ.x}).attr("y",function(a){return a.circ.y});m()}function h(j){console.log(d3.event);if(d3.event.shiftKey){if(enable_piwik&&piwikTracker.trackPageView("Combine node in circular view"),
enable_owa&&OWATracker.trackAction("Viz","Combine circular node",j.name),enable_tracking&&trackAction("Combine circular node",j.name),!(j.parent===i||null===j.parent)){for(var b=active_node_map[j.parent],c=findActiveDescends(b),h=c.length,d=active_data_links.length;d--;)for(var g=active_data_links[d],j=0;j<h;++j){var m=c[j];(g.source===m||g.target===m)&&active_data_links.splice(d,1)}j=a.inArray(c[0],active_data_nodes);d=active_data_nodes[j];d.isActive=!1;b.circ=d.circ;b.isActive=!0;active_data_nodes[j]=
b;for(j=1;j<h;++j)d=c[j],d.isActive=!1,d=a.inArray(d,active_data_nodes),active_data_nodes.splice(d,1);c=active_data_nodes.length;h=2*Math.PI/c;b=b.key;for(j=0;j<c;++j)d=active_data_nodes[j].key,g=b+"-"+d,g=active_node_link_map[g],g!==i&&active_data_links.push(g),g=d+"-"+b,g=active_node_link_map[g],g!==i&&active_data_links.push(g);e(c,h)}}else if(d3.event.altKey)current_mode===mode.exploration?(current_mode=mode.fixation,selectStructure(j.name,!1)):current_mode===mode.fixation&&(current_mode=mode.exploration,
selectStructure(j.name,!0));else if(d3.event.metaKey){active_data_nodes.splice(a.inArray(j,active_data_nodes),1);for(b=active_data_links.length;b--;)c=active_data_links[b],(c.source===j||c.target===j)&&active_data_links.splice(b,1);b=active_data_nodes.length;e(b,2*Math.PI/b);ignored_nodes.push(j);j.isIgnored=!0}else{enable_piwik&&piwikTracker.trackPageView("Expand node in circular view");enable_owa&&OWATracker.trackAction("Viz","Expand circular node",j.name);enable_tracking&&trackAction("Expand circular node",
j.name);b=[];c=j.children;h=c.length;for(d=0;d<h;++d)b.push(active_node_map[c[d]]);c=b.length;if(!(1>c)){for(var h=j.circ.start_angle,d=(j.circ.end_angle-h)/c,g=[],m=[],l=active_data_links.length;l--;){var f=active_data_links[l];f.source===j?(m.push(f.target),active_data_links.splice(l,1)):f.target===j&&(g.push(f.source),active_data_links.splice(l,1))}l=a.inArray(j,active_data_nodes);active_data_nodes[l].isActive=!1;for(var f=g.length,n=m.length,q=active_data_nodes.length+c-1,p=2*Math.PI/q,k=q-1;k>
l;--k)active_data_nodes[k]=active_data_nodes[k-c+1];console.log(active_node_link_map);for(k=l;k<l+c;++k){var w=b[k-l];calculateArcPositions(w,h,d,k-l);w.color=j.color;w.isActive=!0;active_data_nodes[k]=w;for(var v=0;v<f;++v){var s=g[v],s=s.key+"-"+w.key;console.log(s);s=active_node_link_map[s];s!==i&&active_data_links.push(s)}for(v=0;v<n;++v)s=m[v],s=w.key+"-"+s.key,console.log(s),s=active_node_link_map[s],s!==i&&active_data_links.push(s)}for(k=0;k<c;++k)for(v=k+1;v<c;++v)s=b[k].key+"-"+b[v].key,
console.log(s),s=active_node_link_map[s],s!==i&&active_data_links.push(s),s=b[v].key+"-"+b[k].key,s=active_node_link_map[s],s!==i&&active_data_links.push(s);e(q,p)}}}function d(a){enable_piwik&&piwikTracker.trackPageView("Click link in circular view");enable_owa&&OWATracker.trackAction("Viz","Click circular link",a.source.name+"-"+a.target.name);enable_tracking&&trackAction("Click circular link",a.source.name+"-"+a.target.name);displayConnectionInfo(a)}function f(){c.selectAll(".circular.node").data(svgData.circNodes,
function(a){return a.key}).enter().append("svg:path").style("fill",function(a){return a.color}).style("stroke","gray").attr("d",q).attr("class","circular node").attr("id",function(a){return"circ-node-"+a.key}).on("click",h).on("mouseover",function(b){var e=c;console.log(b);if(!(current_mode===mode.search||current_mode===mode.fixation)){var d=brodmann_map[b.brodmannKey];console.log('[title="'+d+'"]');a('[title="'+d+'"]').mouseover();current_mode!==mode.search&&(e.selectAll(".circular.link").classed("hidden",
function(a){return a.source.key!==b.key&&a.target.key!==b.key}),e.selectAll(".circular.link").classed("outLink",function(a){var e=active_node_link_map[a.target.key+"-"+a.source.key];return a.source.key===b.key&&e===i}),e.selectAll(".circular.link").classed("inLink",function(a){var e=active_node_link_map[a.target.key+"-"+a.source.key];return a.target.key===b.key&&e===i}),e.selectAll(".circular.link").classed("biLink",function(a){return active_node_link_map[a.target.key+"-"+a.source.key]!==i}),e.selectAll(".circular.node").classed("nofocus",
function(e){var e=e.key,c=b.key,d=active_node_in_neighbor_map[c],h=active_node_out_neighbor_map[c];return e!==c&&0>a.inArray(e,d)&&0>a.inArray(e,h)}),e.selectAll(".circular.text").classed("visible",function(e){var e=e.key,c=b.key,d=active_node_in_neighbor_map[c],h=active_node_out_neighbor_map[c];return e===c||0<=a.inArray(e,d)||0<=a.inArray(e,h)}))}}).on("mouseout",function(){var b=c;current_mode===mode.search||current_mode===mode.fixation||(a('[title="Areas 3, 1 & 2 - Primary Somatosensory Cortex"]').mouseout(),
current_mode!==mode.search&&(b.selectAll(".circular.node").classed("nofocus",!1),b.selectAll(".circular.link").classed("hidden",!1),b.selectAll(".circular.link").classed("inLink",!1),b.selectAll(".circular.link").classed("outLink",!1),b.selectAll(".circular.link").classed("biLink",!1),m()))});c.selectAll(".circular.text").data(svgData.circNodes,function(a){return a.key}).enter().append("svg:text").attr("x",function(a){return a.circ.x}).attr("y",function(a){return a.circ.y}).attr("class","circular text").attr("id",
function(a){return"text-"+a.key}).text(function(a){return a.name})}function k(){c.selectAll(".circular.link").data(svgData.circLinks,function(a){return a.key}).enter().append("svg:path").attr("d",function(a){return p([{x:a.source.circ.x,y:a.source.circ.y},{x:0,y:0},{x:a.target.circ.x,y:a.target.circ.y}])}).attr("class","circular link").attr("stroke-width",function(a){return Math.min(10,Math.max(1,Math.ceil(a.base_children.length/100)))+"px"}).attr("id",function(a){return"circ-link-"+a.key}).on("mouseover",
function(a){var b=c;current_mode===mode.search||current_mode===mode.fixation||(b.selectAll(".circular.node").classed("nofocus",function(b){return b.key!==a.source.key&&b.key!==a.target.key}),b.selectAll(".circular.link").classed("hidden",function(b){return b.key!==a.key}),b.selectAll(".circular.text").classed("visible",function(b){return b.key===a.source.key||b.key===a.target.key}))}).on("mouseout",function(){var a=c;current_mode===mode.search||current_mode===mode.fixation||(a.selectAll(".circular.node").classed("nofocus",
!1),a.selectAll(".circular.link").classed("hidden",!1),m())}).on("click",d)}function m(){c.selectAll(".circular.text").classed("visible",function(a){a=a.circ;return a.end_angle-a.start_angle>Math.PI/12})}var g=0.32*Math.min(800,600),l=1.2*g;d3.rgb(141,211,199);d3.rgb(255,255,179);d3.rgb(190,186,218);d3.rgb(251,128,114);d3.rgb(128,177,211);d3.rgb(253,180,98);d3.rgb(179,222,105);d3.rgb(252,205,229);d3.rgb(217,217,217);d3.rgb(188,128,189);d3.rgb(204,235,197);d3.rgb(255,237,111);var c,n,q,p;b.prepareCanvas=
function(){q=d3.svg.arc().innerRadius(g).outerRadius(l).startAngle(function(a){return a.circ.start_angle}).endAngle(function(a){return a.circ.end_angle});p=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis");c=d3.select("#canvas-circular").append("svg").attr("width",800).attr("height",600).append("g").attr("transform","translate(400,300)").append("g");n=d3.select("#canvas-force").append("svg").attr("width",800).attr("height",600).append("g")};b.renderData=function(a){svgData.init(a);
c.selectAll(".circular").remove();n.selectAll(".force").remove();k();f();m()}})(window.svgRenderer=window.svgRenderer||{},jQuery);(function(b,a){b.bind=function(){d3.select("#bt-search").on("click",searchUI.searchButtonClick);d3.select("#bt-clear").on("click",searchUI.clearButtonClick);d3.select("#bt-createDatasets").on("click",datasetManager.createDatasetButtonClick);d3.select("#bt-manageDatasets").on("click",datasetManager.manageDatasetButtonClick);d3.select("#bt-cloneDatasets").on("click",datasetManager.cloneDatasetButtonClick);d3.select("#bt-applyDataset").on("click",datasetManager.applyDatasetButtonClick);d3.select("#maxHop").on("change",
searchUI.setMaxHop);a("#conn-note-edit").click(chosenLink.editNotes);a("#conn-note-save").click(chosenLink.saveNotes);a("#sourceSelect").change(searchUI.sourceSearchInput);a("#targetSelect").change(searchUI.targetSearchInput);a("#dataSelect").change(datasetManager.datasetSelect);window.onbeforeunload=database.saveSessionData;window.onload=startSession};b.setupUIElements=function(){b.appendNodesAsOptions(active_node_map)};b.appendNodesAsOptions=function(b){for(var e in b){var h=b[e];a("#sourceSelect").append(new Option(h.name,
e,!1,!1));a("#targetSelect").append(new Option(h.name,e,!1,!1))}a(".chzn-select").chosen({allow_single_deselect:!0});a("#sourceSelect").trigger("liszt:updated");a("#targetSelect").trigger("liszt:updated")}})(window.ui=window.ui||{},jQuery);
(function(b,a,i){b.max_hop=1;b.selected_source=null;b.selected_target=null;b.updateOptions=function(){a("#sourceSelect").find("option").remove();a("#targetSelect").find("option").remove();a("#sourceSelect").trigger("liszt:updated");a("#targetSelect").trigger("liszt:updated");appendNodesAsOptions(activeDataset.maps.node_map)};b.searchButtonClick=function(){enable_piwik&&piwikTracker.trackPageView("Search:"+selected_source.name+"-"+selected_target.name);enable_owa&&OWATracker.trackAction("UI","Search",
selected_source.name+"-"+selected_target.name);enable_tracking&&trackAction("Search",selected_source.name+"-"+selected_target.name);current_mode=mode.search;var a=calculatePaths(max_hop);populateForceElements(a);updateForceLayout();dimNonSearchResults()};b.clearButtonClick=function(){enable_piwik&&piwikTracker.trackPageView("Click clear button");current_mode=mode.exploration;svg_circular.selectAll(".circular.node").classed("nofocus",!1);svg_circular.selectAll(".circular.link").classed("hidden",!1);
updateCircularTexts()};b.sourceSearchInput=function(){enable_piwik&&piwikTracker.trackPageView("Set search source");selected_source!=i&&(selected_source.fixed=!1,highlightNode(selected_source,"focus",!1,!0,svg_circular),clearSearchResult());var a=active_node_map[this.value];selected_source=a;if(!a.isActive){var b=findActiveParent(a);b===i?(b=findActiveDescends(a),combineRegions(a,b)):(a=findDescAtDepth(b,a.depth),expandRegion(b,a,svg_circular))}svg_circular.selectAll(".circular.node").classed("nofocus",
function(a){return a!==selected_source&&a!==selected_target});svg_circular.selectAll(".circular.text").classed("visible",function(a){return a===selected_source||a===selected_target});enable_owa&&OWATracker.trackAction("UI","Set source",selected_source.name);enable_tracking&&trackAction("Set source",selected_source.name)};b.targetSearchInput=function(){enable_piwik&&piwikTracker.trackPageView("Set search target");selected_target!=i&&(selected_target.fixed=!1,highlightNode(selected_target,"focus",!1,
!0,svg_circular),clearSearchResult());var a=active_node_map[this.value];selected_target=a;if(!a.isActive){var b=findActiveParent(a);b===i?(b=findActiveDescends(a),combineRegions(a,b)):(a=findDescAtDepth(b,a.depth),expandRegion(b,a,svg_circular))}svg_circular.selectAll(".circular.link").classed("hidden",function(a){return a.source.key!==selected_source.key&&a.target.key!==selected_target.key});svg_circular.selectAll(".circular.node").classed("nofocus",function(a){return a!==selected_source&&a!==selected_target});
svg_circular.selectAll(".circular.text").classed("visible",function(a){return a===selected_source||a===selected_target});enable_owa&&OWATracker.trackAction("UI","Set target",selected_target.name);enable_tracking&&trackAction("Set target",selected_target.name)};b.clearSearchResult=function(){};b.setMaxHop=function(){enable_piwik&&piwikTracker.trackPageView("Set max hop");enable_owa&&OWATracker.trackAction("UI","Set max hop",this.value);enable_tracking&&trackAction("Set max hop",this.value);max_hop=
this.value;document.getElementById("maxHopValue").innerHTML=max_hop}})(window.searchUI=window.searchUI||{},jQuery);
(function(b,a,i){b.datasetSelect=function(){var b=a("#dataSelect :selected").text();endsWith(b,"(public)")?(a("#bt-cloneDatasets").css("display","block"),a("#bt-manageDatasets").css("display","none")):(a("#bt-cloneDatasets").css("display","none"),a("#bt-manageDatasets").css("display","block"))};b.populateDatasetUI=function(){a("#dataSelect").append(new Option("BAMS (public)",2130));a("#dataSelect").append(new Option("Pubmed (public)",1000002));for(var b=dataset_list.length,h=0;h<b;++h){var d=dataset_list[h];
a("#dataSelect").append(new Option(d[1],d[0]))}};b.createDatasetButtonClick=function(){database.createDataset(a('[name="datasetName"]').val(),uid,0)};b.manageDatasetButtonClick=function(){var b=a("#dataSelect :selected").text(),h=a("#dataSelect").val(),d=endsWith(b,"(personal copy)")?1:0;window.open("media/php/manageDataset.php?datasetName="+b+"&datasetID="+h+"&isClone="+d,"_blank","width=800, height=800")};b.cloneDatasetButtonClick=function(){var b=a("#dataSelect :selected").text().replace("(public)",
"(personal copy)"),h=a("#dataSelect").val();database.cloneDataset(b,uid,h)};b.applyDatasetButtonClick=function(){var b=parseInt(a("#dataSelect").val());""!==b&&user_datasets[b]===i&&database.getBrainData(b,uid)}})(window.datasetManager=window.datasetManager||{},jQuery);
(function(b,a,i){function e(a){switch(a){case "edit":d.css("display",display);f.css("display",edit);k.css("display",edit);break;case "display":d.css("display",display),f.css("display",edit),k.css("display",edit)}}function h(){var b=a(this).text();enable_owa&&OWATracker.trackAction("UI","Click paper",b);enable_tracking&&(console.log("tracking paper click"),trackAction("Click paper",b))}b.link=null;var d=a("#conn-note-display"),f=a("#conn-note-input"),k=a("#conn-note-save");b.editNotes=function(){e("edit")};
b.saveNotes=function(){b.link.notes=f.value();e("display");d.text(b.link.notes);database.updateLink(b.link.key,b.link.notes)};b.displayConnectionInfo=function(a){d3.selectAll("#conn-info .exp").remove();d3.select("#conn-info #src-name").html("Source: "+a.source.name);d3.select("#conn-info #tgt-name").html("Target: "+a.target.name);var b=active_node_link_map[a.target.key+"-"+a.source.key];if(!is_preloaded_data){var e=d3.select("#notes");e.selectAll("div").remove();e.selectAll("p").remove();for(var e=
e.append("div"),c="<p>Current link: "+a.source.name+"-"+a.target.name+"</p>",c=a.isDerived?c+"<p>This is a meta link. See the derived connections for user entered notes.</p>":c+("<p>"+a.notes+"</p>"),c=c+'<p>Children links:</p><table class="table table-bordered table-striped table-condensed"><tr class="tableTitle"><td>Source</td><td>Target</td><td>Notes</td></tr>',d=a.base_children.length,f=0;f<d;++f)var k=active_link_map[a.base_children[f]],c=c+("<tr><td>"+k.source.name+"</td><td>"+k.target.name+
"</td><td>"+k.notes+"</td></tr>");c+="</table>";if(b!==i){c+="<p>Current link: "+a.target.name+"-"+a.source.name+"</p>";c=b.isDerived?c+"<p>This is a meta link. See the derived connections for user entered notes.</p>":c+("<p>"+b.notes+"</p>");c+="<p>Children links:</p>";c+='<table class="table table-bordered table-striped table-condensed"><tr class="tableTitle"><td>Source</td><td>Target</td><td>Notes</td></tr>';d=b.base_children.length;for(f=0;f<d;++f)k=active_link_map[b.base_children[f]],c+="<tr><td>"+
k.source.name+"</td><td>"+k.target.name+"</td><td>"+k.notes+"</td></tr>";c+="</table>"}e.html(c)}if(is_preloaded_data){d=a.paper;e=d3.select("#paper-list");e.selectAll("div").remove();e.selectAll("p").remove();e=e.append("div");c="<p>Current link: "+a.source.name+"-"+a.target.name+"</p>";if(a.isDerived)c+="<p>This is a meta link. See the derived connections for more information.</p>";else{c+='<table class="table table-bordered table-striped table-condensed"><tr class="tableTitle"><td>Publication</td></tr>';
b=d.length;for(f=0;f<b;++f)var j=paper_map[d[f]],c=c+('<tr><td><a href="'+j.url+'" target="_blank" class="paperLink">'+j.title+"</a></td></tr>")}c+="</table>";c+="<p>Children links:</p>";c+='<table class="table table-bordered table-striped table-condensed"><tr class="tableTitle"><td>Source</td><td>Target</td><td>Publication</td></tr>';d=a.base_children.length;for(f=0;f<d;++f)for(var k=active_link_map[a.base_children[f]],t=k.paper,b=t.length,r=0;r<b;++r)j=paper_map[t[r]],c+="<tr><td>"+k.source.name+
"</td><td>"+k.target.name+'</td><td><a href="'+j.url+'" target="_blank" class="paperLink">'+j.title+"</a></td></tr>";c+="</table>";e.html(c);d3.selectAll(".paperLink").on("click",h);e=d3.select("#bams-list");e.selectAll("p").remove();e=e.append("p");e.html("Links to BAMS records will be added in future updates")}a=a.children;e=d3.select("#sub-con-list");e.selectAll("p").remove();e=e.append("p");1>a.length?e.html("There are no sub-connections for this link."):e.selectAll("p").data(a).enter().append("p").html(function(a){a=
active_link_map[a];return"Source: "+a.source.name+"; Target: "+a.target.name})}})(window.chosenLink=window.chosenLink||{},jQuery);(function(b,a){var i=function(b,h,d,f){a.ajax({type:"POST",url:"media/php/"+b,data:h,error:function(a){console.log("Failed when calling "+b);console.log(a)},success:function(a){console.log("Successfully called "+b);d&&d(a)},async:f})};b.createDataset=function(b,h,d){i("addDataset.php",{datasetName:b,userID:h,isClone:!1,origDatasetID:d},function(d){a("#dataSelect").append(new Option(b,d));a("#dataSelect").trigger("liszt:updated");a("#createDatasetSuccessAlert").show()},!0)};b.cloneDataset=function(b,
h,d){i("addDataset.php",{datasetName:b,userID:h,isClone:!0,origDatasetID:d},function(d){a("#dataSelect").append(new Option(b,d));a("#dataSelect").trigger("liszt:updated");a("#createDatasetSuccessAlert").show()},!0)};b.saveSessionData=function(){sessionEndTime=new Date;var a=sessionEndTime-sessionStartTime;i("writeActionData.php",{actionDataArray:actionData,sessionLength:a/1E3,userID:uid},null,!1)};b.populateUserID=function(){i("getUserID.php",null,function(a){user.id=a;b.populateDatasets(user.id)},
!0)};b.populateDatasets=function(b){i("getDatasetByUserId.php",{userID:b},function(b){dataset_list=a.parseJSON(b);populateDatasetUI()},!1)};b.getBrainData=function(b,h){phpToPhp("getBrainData.php",{datasetKey:b,userID:h},function(d){d=a.parseJSON(d);dataModel.constructDataModel(b,d.nodes,d.links,d.diff_nodes,d.diff_links);activeDataset.maps=user.datasets[b];searchUI.updateOptions();svgRenderer.renderData(b)},!0)};b.getBrodmannAreas=function(){var b=function(b){b=a.parseJSON(b);constructBrodmannMap(b)};
a.ajax({type:"GET",url:"media/php/getBrodmannAreas.php",error:function(a){console.log("Failed when calling getBrodmannAreas.php");console.log(a)},success:function(a){console.log("Successfully called getBrodmannAreas.php");b&&b(a)},async:!0})};b.updateLink=function(a,b){i("updateBrainLink.php",{linkKey:a,userID:datasetProperties.userID,notes:b,isClone:datasetProperties.isClone,origin:datasetProperties.origin},null,!0)}})(window.database=window.database||{},jQuery);(function(){var b=[],a=null,i=null,e=-1,h="",d="",f="",k=-1;userAction.trackAction=function(m,g){d=m;f=g;i=new Date;e=(i-a)/1E3;k=i.toString();b.push({timeElapsed:e,mouseTrace:h,actionBasic:d,actionDetail:f,time:k});a=new Date;e=-1;f=d=h="";k=-1}})(window.userAction=window.userAction||{},jQuery);(function(b){b.directionType={"in":1,out:2,bi:3};b.mode={exploration:1,search:2,fixation:3}})(window.customEnum=window.customEnum||{},jQuery);(function(b){b.contains=function(a,b){for(var e=a.length,h=0;h<e;++h)if(b.key===a[h].key)return h;return-1};b.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)};b.findMaxElement=function(a,b){for(var e=0,h=a.length,d=0;d<h;++d){var f=a[d][b];console.log(f);e=f>e?f:e}return e}})(window.generic=window.generic||{},jQuery);$(document).ready(function(){database.getBrainData(datasetProperties.key,0);ui.bind();svgRenderer.prepareCanvas()});var API_PATH="http://api.brain-map.org/api/v2/",SVG_DOWNLOAD_PATH=API_PATH+"svg/",IMG_DOWNLOAD_PATH=API_PATH+"section_image_download/",STRUCTURES_URL=API_PATH+"data/Structure/query.json?criteria=[graph_id$eq1]&num_rows=all",curr_image_id=100960224,DOWNSAMPLE=5,urlVars=getUrlVars();"id"in urlVars&&(curr_image_id=urlVars.id);"downsample"in urlVars&&(DOWNSAMPLE=urlVars.downsample);var _structures={},struct_img_map={},tempSelPath=null;
function format_url(b,a,i){return b+a+"?"+$.map(i,function(a,b){return b+"="+a}).join("&")}function download_structures(b){$.getJSON(STRUCTURES_URL,function(a){for(var i=0;i<a.msg.length;i++){var e=a.msg[i];_structures[e.id]=e}b()})}
function download_svg(b){$("#anatomy-map #svg").load(b,function(){$("#anatomy-map path").attr("title",function(){var a=$(this).attr("structure_id");return _structures[a].name});$("#anatomy-map path").qtip();$("#anatomy-map path").hover(function(){$(this).attr("class","hover")},function(){$(this).attr("class","")});null!==tempSelPath&&($(tempSelPath).attr("class","hover"),$(tempSelPath).qtip("toggle",!0),tempSelPath=null)})}
function download_img(b){var a=new Image;a.onload=function(){$("#anatomy-map #img").empty();$("#anatomy-map #img").append(a)};a.src=b}function getUrlVars(){for(var b=[],a,i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<i.length;e++)a=i[e].split("="),b.push(a[0]),b[a[0]]=a[1];return b}
function selectStructure(b,a){console.log("selectStructure");console.log(b);var i="path[oldtitle='"+b+"']";if(a)$(i).attr("class",""),$(i).qtip("toggle",!1);else{var e=null,h;for(h in _structures)if(_structures[h].name===b){e=h;break}struct_img_map[e]!==curr_image_id?(curr_image_id=struct_img_map[e],tempSelPath=i,updateImages()):($(i).attr("class","hover"),$(i).qtip("toggle",!0))}}
function retrieveStructImageMap(){$.ajax({type:"GET",url:"media/php/getStructImgMap.php",error:function(b){console.log("Failed");console.log(b)},success:function(b){console.log("Success");b=$.parseJSON(b);console.log(b);for(var a=0;a<b.length;++a){var i=b[a];struct_img_map[i.structKey]=i.imageKey}}})}function updateImages(){download_svg(format_url(SVG_DOWNLOAD_PATH,curr_image_id,args));download_img(format_url(IMG_DOWNLOAD_PATH,curr_image_id,args))}
$(function(){$("#anatomy-map").css("background",'no-repeat center url("media//img/loading.gif")');retrieveStructImageMap();download_structures(function(){$("#anatomy-map").css("background","");args={downsample:DOWNSAMPLE};updateImages()})});
